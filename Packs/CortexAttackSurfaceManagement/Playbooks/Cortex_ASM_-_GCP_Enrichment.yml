id: Cortex ASM - GCP Enrichment
version: -1
name: Cortex ASM - GCP Enrichment
description: Given the IP address this playbook enriches GCP and Firewall information.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 0dc297ae-2f81-4517-8388-6ddd15cbe420
    type: start
    task:
      id: 0dc297ae-2f81-4517-8388-6ddd15cbe420
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 877.5,
          "y": 20
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 5ec81743-df8f-43e9-8e75-4921453e9b98
    type: playbook
    task:
      id: 5ec81743-df8f-43e9-8e75-4921453e9b98
      version: -1
      name: GCP - Enrichment
      description: Given the IP address this playbook enriches GCP and Firewall information.
      playbookName: GCP - Enrichment
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      GcpIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 877.5,
          "y": 165
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: f8544c44-1c32-49e8-81e7-a4e1b30f3cf1
    type: title
    task:
      id: f8544c44-1c32-49e8-81e7-a4e1b30f3cf1
      version: -1
      name: Set Field
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "4"
      - "5"
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 877.5,
          "y": 340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 449bacac-fce7-4398-82ea-c5db64daad08
    type: condition
    task:
      id: 449bacac-fce7-4398-82ea-c5db64daad08
      version: -1
      name: Is there VM and IAM information?
      description: Determines if there is EC2 information to set the private IP, cloud, and tags fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "48"
      "yes":
      - "14"
      - "17"
      - "15"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: GoogleCloudCompute
                accessor: Instances
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2010,
          "y": 540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 6f5c5d04-1d8d-468c-86ae-68a800fe8a75
    type: condition
    task:
      id: 6f5c5d04-1d8d-468c-86ae-68a800fe8a75
      version: -1
      name: Is there IAM information?
      description: Determines if there is IAM information to set in the service owner field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "41"
      "yes":
      - "11"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: GCPIAM.Policy.bindings
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: GCPIAM.Policy.bindings.role
                      iscontext: true
                    right:
                      value:
                        simple: roles/owner
                accessor: members
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 100,
          "y": 485
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: eee777ae-554c-44c5-85c6-0cf4dcdf5a9f
    type: condition
    task:
      id: eee777ae-554c-44c5-85c6-0cf4dcdf5a9f
      version: -1
      name: Is there VM and firewall information?
      description: Determines if there is EC2 and security group information to set in the system IDs field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "41"
      "yes":
      - "19"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: GoogleCloudCompute
                accessor: Instances
            iscontext: true
          right:
            value: {}
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: GoogleCloudCompute
                accessor: Firewalls
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 877.5,
          "y": 485
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: f82fd840-cb14-4787-84c2-65adbb5e12c5
    type: regular
    task:
      id: f82fd840-cb14-4787-84c2-65adbb5e12c5
      version: -1
      name: Set service owner grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "42"
    scriptarguments:
      gridfield:
        simple: asmserviceowner
      keys:
        simple: Name,Email,Source,Timestamp
      val1:
        simple: n/a
      val2:
        complex:
          root: GCPIAM.Policy.bindings
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: GCPIAM.Policy.bindings.role
                iscontext: true
              right:
                value:
                  simple: roles/owner
          accessor: members
          transformers:
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: 'user:'
      val3:
        simple: GCP
      val4:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 100,
          "y": 850
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 2f25f6b9-fb2f-4259-87de-a7792da165ae
    type: title
    task:
      id: 2f25f6b9-fb2f-4259-87de-a7792da165ae
      version: -1
      name: Service Owner
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "10"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 100,
          "y": 700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 7c195a24-8808-4ac6-8cd3-43229c44693c
    type: regular
    task:
      id: 7c195a24-8808-4ac6-8cd3-43229c44693c
      version: -1
      name: Set private IP grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      gridfield:
        simple: asmprivateip
      keys:
        simple: IP,Source
      val1:
        complex:
          root: GoogleCloudCompute.Instances.networkInterfaces
          accessor: networkIP
          transformers:
          - operator: uniq
      val2:
        simple: GCP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2402.5,
          "y": 1005
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 4cd93762-eff0-4552-8a5a-adddde71fb51
    type: title
    task:
      id: 4cd93762-eff0-4552-8a5a-adddde71fb51
      version: -1
      name: Private IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "13"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2402.5,
          "y": 865
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 424aadfd-2ed5-459f-81a8-c3f80a50c0f6
    type: title
    task:
      id: 424aadfd-2ed5-459f-81a8-c3f80a50c0f6
      version: -1
      name: Cloud
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "39"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1557.5,
          "y": 765
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 5741cbd7-36a7-4297-8094-ac1391b804c5
    type: regular
    task:
      id: 5741cbd7-36a7-4297-8094-ac1391b804c5
      version: -1
      name: Set cloud grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      gridfield:
        simple: asmcloud
      keys:
        simple: Provider,Organization,Project,Region,Other
      val1:
        simple: GCP
      val2:
        simple: n/a
      val3:
        complex:
          root: GoogleCloudCompute.Instances.networkInterfaces
          accessor: network
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (?<=projects/)[^/]+(?=/global)
              unpack_matches: {}
          - operator: uniq
      val4:
        complex:
          root: GoogleCloudCompute.Instances
          accessor: zone
          transformers:
          - operator: uniq
      val5:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1547.5,
          "y": 1275
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: d1d2ccd2-8f8f-4189-84c5-0b18956f93f1
    type: title
    task:
      id: d1d2ccd2-8f8f-4189-84c5-0b18956f93f1
      version: -1
      name: Tags
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "29"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2872.5,
          "y": 820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 841387d3-2007-4909-8c37-7db182501529
    type: regular
    task:
      id: 841387d3-2007-4909-8c37-7db182501529
      version: -1
      name: Set tags grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "52"
    scriptarguments:
      gridfield:
        simple: asmtags
      keys:
        simple: Key,Value,Source
      val1:
        complex:
          root: GoogleCloudCompute.Instances
          accessor: labels
          transformers:
          - operator: jmespath
            args:
              expression:
                value:
                  simple: keys(@)
      val2:
        complex:
          root: GoogleCloudCompute.Instances
          accessor: labels
          transformers:
          - operator: jmespath
            args:
              expression:
                value:
                  simple: values(@)
      val3:
        simple: GCP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2872.5,
          "y": 1170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 3ed16fa2-8b85-4c89-854b-933ca8edc124
    type: title
    task:
      id: 3ed16fa2-8b85-4c89-854b-933ca8edc124
      version: -1
      name: System IDs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: b5a86395-b020-4413-8ac9-92f8592aba5b
    type: regular
    task:
      id: b5a86395-b020-4413-8ac9-92f8592aba5b
      version: -1
      name: Set system IDs grid field (VPC)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: GCP-VPC
      val2:
        complex:
          root: GoogleCloudCompute.Instances.networkInterfaces
          accessor: network
          transformers:
          - operator: uniq
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 835
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: a2371f8b-3344-409c-8474-1e8dd4c6f22b
    type: regular
    task:
      id: a2371f8b-3344-409c-8474-1e8dd4c6f22b
      version: -1
      name: Set system IDs grid field (FW)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: GCP-FW
      val2:
        complex:
          root: GoogleCloudCompute.Firewalls
          accessor: id
          transformers:
          - operator: uniq
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 1010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: cb82c884-2ed0-441a-86c7-7b6b6e3d122d
    type: regular
    task:
      id: cb82c884-2ed0-441a-86c7-7b6b6e3d122d
      version: -1
      name: Set system IDs grid field (NET)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: GCP-NET
      val2:
        complex:
          root: GoogleCloudCompute.Instances.networkInterfaces
          accessor: subnetwork
          transformers:
          - operator: uniq
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 1185
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: b540f478-b36e-4f0f-8e09-3bf2703b8fcc
    type: regular
    task:
      id: b540f478-b36e-4f0f-8e09-3bf2703b8fcc
      version: -1
      name: Set system IDs grid field (NIC)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: GCP-NIC
      val2:
        complex:
          root: GoogleCloudCompute.Instances.networkInterfaces
          accessor: name
          transformers:
          - operator: uniq
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: f0adfbe7-516c-417b-89a8-b9606cdc42b2
    type: regular
    task:
      id: f0adfbe7-516c-417b-89a8-b9606cdc42b2
      version: -1
      name: Set system IDs grid field (VM)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: GCP-VM
      val2:
        complex:
          root: GoogleCloudCompute.Instances
          accessor: id
          transformers:
          - operator: uniq
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 1535
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: f7184508-81dc-41f7-898c-799716454e58
    type: regular
    task:
      id: f7184508-81dc-41f7-898c-799716454e58
      version: -1
      name: Set system IDs grid field (ZONE)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: GCP-ZONE
      val2:
        complex:
          root: GoogleCloudCompute.Instances
          accessor: zone
          transformers:
          - operator: uniq
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (?<=zones\/)[^$]+
              unpack_matches: {}
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 1710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: b75ef9ac-a166-428e-8576-868916c14f17
    type: regular
    task:
      id: b75ef9ac-a166-428e-8576-868916c14f17
      version: -1
      name: Set system IDs grid field (VM NAME)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "47"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: GCP-VMNAME
      val2:
        complex:
          root: GoogleCloudCompute.Instances
          accessor: name
          transformers:
          - operator: uniq
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 1885
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 84c24a9c-c4c7-4b6d-87f0-c64d5c218768
    type: condition
    task:
      id: 84c24a9c-c4c7-4b6d-87f0-c64d5c218768
      version: -1
      name: Are there any tags?
      description: |+
        Check whether there are any tags associated to instances.

      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "49"
      "yes":
      - "18"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: GoogleCloudCompute.Instances
                accessor: labels
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2872.5,
          "y": 950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 0419dfa0-3842-41ab-8152-00af28975899
    type: condition
    task:
      id: 0419dfa0-3842-41ab-8152-00af28975899
      version: -1
      name: Is service account field set?
      description: Determines if a service account associated with the Cloud Compute Instance was discovered and set on the alert.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "40"
      "yes":
      - "32"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: GoogleCloudCompute.Instances.serviceAccounts
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 100,
          "y": 1205
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 6a043b80-42e2-4872-862e-c312b4933827
    type: regular
    task:
      id: 6a043b80-42e2-4872-862e-c312b4933827
      version: -1
      name: Add service account to unranked service owner list
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      gridfield:
        simple: asmserviceownerunrankedraw
      keys:
        simple: name,email,source,timestamp
      val1:
        simple: n/a
      val2:
        complex:
          root: GoogleCloudCompute.Instances
          accessor: serviceAccounts
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: email
      val3:
        simple: GCP
      val4:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 100,
          "y": 1425
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 1fd4ecd3-60f9-443d-845a-2284574d334b
    type: condition
    task:
      id: 1fd4ecd3-60f9-443d-845a-2284574d334b
      version: -1
      name: Is there GCP project hierarchy information?
      description: Determines if there is GCP hierarchy information to set in the system IDs field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "43"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: GCPHierarchy
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: GCPHierarchy.level
                      iscontext: true
                    right:
                      value:
                        simple: project
                accessor: number
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 2280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 423ce0b2-17cb-4f63-87bf-c69ffad85762
    type: regular
    task:
      id: 423ce0b2-17cb-4f63-87bf-c69ffad85762
      version: -1
      name: Set system IDs grid field (Project-Number)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: GCP-Project-Number
      val2:
        complex:
          root: GCPHierarchy
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: GCPHierarchy.level
                iscontext: true
              right:
                value:
                  simple: project
          accessor: number
          transformers:
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: projects/
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 2510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: b7a958b5-868c-4d8f-84fc-1437b14af38e
    type: condition
    task:
      id: b7a958b5-868c-4d8f-84fc-1437b14af38e
      version: -1
      name: Is there GCP folder hierarchy information?
      description: Determines if there is GCP folder hierarchy information to set in the system IDs field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "43"
      "yes":
      - "36"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: GCPHierarchy.number
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: GCPHierarchy.number
                      iscontext: true
                    right:
                      value:
                        simple: folders/
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 2720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: b5042749-e602-4dc2-89cf-f2359a8c3f2b
    type: regular
    task:
      id: b5042749-e602-4dc2-89cf-f2359a8c3f2b
      version: -1
      name: Set system IDs grid field (Folder-Number)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "43"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: GCP-Folder-Number
      val2:
        complex:
          root: GCPHierarchy.number
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: GCPHierarchy.number
                iscontext: true
              right:
                value:
                  simple: folders/
          transformers:
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: folders/
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 2960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 08c7fc53-9e69-41cf-8fd5-5cb6662c156b
    type: regular
    task:
      id: 08c7fc53-9e69-41cf-8fd5-5cb6662c156b
      version: -1
      name: Set Folders
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      key:
        simple: folder-ids
      value:
        complex:
          root: GCPHierarchy.id
          filters:
          - - operator: startWith
              left:
                value:
                  simple: GCPHierarchy.id
                iscontext: true
              right:
                value:
                  simple: folders/
          transformers:
          - operator: join
            args:
              separator:
                value:
                  simple: ','
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1802.5,
          "y": 1075
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: cfae9206-5e90-4057-8923-383e3507d116
    type: regular
    task:
      id: cfae9206-5e90-4057-8923-383e3507d116
      version: -1
      name: Set Folders to n/a
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      key:
        simple: folder-ids
      value:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1402.5,
          "y": 1075
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: e2ebfae4-d4b6-4caf-8ab6-7b650179027e
    type: condition
    task:
      id: e2ebfae4-d4b6-4caf-8ab6-7b650179027e
      version: -1
      name: Are there any folders?
      type: condition
      description: Determines if there is GCP folder information to set in the cloud field.
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "37"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: GCPHierarchy.id
                filters:
                - - operator: startWith
                    left:
                      value:
                        simple: GCPHierarchy.id
                      iscontext: true
                    right:
                      value:
                        simple: folders/
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1557.5,
          "y": 875
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: bc27f5ab-5346-4020-891d-448420f35c5e
    type: title
    task:
      id: bc27f5ab-5346-4020-891d-448420f35c5e
      version: -1
      name: Service Owner - End
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 100,
          "y": 1665
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 78359ff7-a2da-4fd8-83b5-ae0e3fc9af95
    type: regular
    task:
      id: 78359ff7-a2da-4fd8-83b5-ae0e3fc9af95
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "43"
      - "40"
    scriptarguments:
      key:
        simple: asm_enrichment_flag_gcp
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 520,
          "y": 1205
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: dbed1b2a-1f74-4275-8d90-fb5a4d573b6f
    type: regular
    task:
      id: dbed1b2a-1f74-4275-8d90-fb5a4d573b6f
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      key:
        simple: asm_enrichment_flag_gcp
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 100,
          "y": 1030
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 46565666-ada8-4333-86e1-570916715919
    type: title
    task:
      id: 46565666-ada8-4333-86e1-570916715919
      version: -1
      name: System IDs - End
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 740,
          "y": 3150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 3a457b13-462f-42eb-83af-a5c4a6ef4fd1
    type: title
    task:
      id: 3a457b13-462f-42eb-83af-a5c4a6ef4fd1
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1550,
          "y": 3540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: f630e483-e745-4727-8213-95e616f7dbe5
    type: regular
    task:
      id: f630e483-e745-4727-8213-95e616f7dbe5
      version: -1
      name: Set ASM enrichment status
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "44"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: GCP
      val2:
        complex:
          root: asm_enrichment_flag_gcp
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1550,
          "y": 3370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: 6e0cf52c-d161-4440-8aaa-9b6708311699
    type: regular
    task:
      id: 6e0cf52c-d161-4440-8aaa-9b6708311699
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      key:
        simple: asm_enrichment_flag_gcp
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 2060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 3befc322-5741-486b-8a3f-c3faa8ca551f
    type: regular
    task:
      id: 3befc322-5741-486b-8a3f-c3faa8ca551f
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      key:
        simple: asm_enrichment_flag_gcp
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2000,
          "y": 1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 64e95ba4-a7c7-499b-8883-994a84448524
    type: title
    task:
      id: 64e95ba4-a7c7-499b-8883-994a84448524
      version: -1
      name: Tags - End
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2872.5,
          "y": 1535
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: eeb597c6-39d8-4f63-8711-3ff45557ab74
    type: regular
    task:
      id: eeb597c6-39d8-4f63-8711-3ff45557ab74
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "51"
    scriptarguments:
      key:
        simple: asm_enrichment_flag_gcp
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2402.5,
          "y": 1170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: c3b72af8-1c76-4ee7-89a5-bc33748664f3
    type: title
    task:
      id: c3b72af8-1c76-4ee7-89a5-bc33748664f3
      version: -1
      name: Private IP - End
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2402.5,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 1afa39b7-85d0-44e4-8d57-902a66027cee
    type: regular
    task:
      id: 1afa39b7-85d0-44e4-8d57-902a66027cee
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    scriptarguments:
      key:
        simple: asm_enrichment_flag_gcp
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2872.5,
          "y": 1345
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: d327a2fc-7216-4d3d-84ab-a9de64931fea
    type: regular
    task:
      id: d327a2fc-7216-4d3d-84ab-a9de64931fea
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "54"
    scriptarguments:
      key:
        simple: asm_enrichment_flag_gcp
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1547.5,
          "y": 1450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: 3e56b2ac-f39b-42f0-81df-6ca4caa4febe
    type: title
    task:
      id: 3e56b2ac-f39b-42f0-81df-6ca4caa4febe
      version: -1
      name: Cloud - End
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1547.5,
          "y": 1620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "29_18_yes": 0.56,
      "31_32_yes": 0.68,
      "33_34_yes": 0.5,
      "33_43_#default#": 0.11,
      "35_36_yes": 0.54,
      "35_43_#default#": 0.2,
      "39_37_yes": 0.63,
      "39_38_#default#": 0.65,
      "3_17_yes": 0.76,
      "4_41_#default#": 0.31,
      "5_41_#default#": 0.41
    },
    "paper": {
      "dimensions": {
        "height": 3585,
        "width": 3152.5,
        "x": 100,
        "y": 20
      }
    }
  }
inputs:
- key: RemoteIP
  value:
    complex:
      root: alert
      accessor: remoteip
  required: false
  description: IP address of service
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.8.0
